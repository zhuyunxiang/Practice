angular.module("Utils-table",["Utils-table-Directives"]),UtilsTableDirectives=angular.module("Utils-table-Directives",["Utils-table-Filters"]),UtilsTableFilters=angular.module("Utils-table-Filters",[]),UtilsTableDirectives.directive("utilTable",[function(){return{restrict:"ECA",transclude:!0,template:'<table class="table table-bordered"><tr><th ng-show="config.showIndex">序号</th><th ng-repeat="titleItem in config.attr" ng-show="config.attr&&config.attr.length" <span ng-click="setOrderInfo(titleItem)" style="cursor:pointer">{{titleItem.title}}<i class="glyphicon" ng-show="titleItem.key==sortPredicate" ng-class="{true:b, false:a}[reverseOrder]"></i></span></th><th ng-show="config.opt&&config.opt.length">操作</th></tr><tr ng-repeat="rowData in dataSource|limitTo:config.limitLength|filter:config.searchKeyword|autoSortBy:sortPredicate:reverseOrder"><td ng-show="config.showIndex">{{$index+1}}</td><td ng-repeat="attrInfo in rowData|filterAttributes:config.attr" title="{{attrInfo}}">{{attrInfo}}</td><td ng-show="config.opt&&config.opt.length"><span ng-repeat="oItem in config.opt" util-table-btn-options oitem="oItem" optiondata="rowData"></span></td></tr></table>',replace:!0,scope:{config:"=config",dataSource:"=datasource"},link:function(t,e,i){t.sortPredicate=t.config&&t.config.order&&t.config.order.colum||"name",t.reverseOrder=t.config&&t.config.order&&t.config.order.type||!1,t.a="glyphicon-sort-by-attributes",t.b="glyphicon-sort-by-attributes-alt",t.setOrderInfo=function(e){t.sortPredicate=e.key,t.reverseOrder=!t.reverseOrder}}}}]),UtilsTableDirectives.directive("utilTableBtnOptions",[function(){return{restrict:"ECA",transclude:!0,template:'<div style="display:inline-block;"><div class="dropdown" class="{{oitem.class}}"ng-style="oitem.style" ng-show="oitem.isDropDown"> <button class="btn btn-default dropdown-toggle btn-xs" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{oitem.title}}<span class="caret"></span> </button> <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"> <li ng-repeat="(dpk,dpv) in oitem.dropdownList" ng-hide="dpv.isHide||dpv.setHide(optiondata,oitem)"><a href="#" ng-click="dpv.callback(optiondata,oitem)">{{dpv.name}}</a></li></ul> </div><button ng-disabled="isDisabled" class="{{oitem.class}}"ng-style="oitem.style" ng-show="oitem.isBtn&&isShow">{{oitem.title}}</button><select ng-show="oitem.isSelect&&isShow" ng-model="optiondata[oitem.attrName]" class="{{oitem.class}}"ng-style="oitem.style" ng-options="k.value as k.name for k in oitem.selectOptions"><option value="">请选择</option></select></div>',replace:!0,scope:{oitem:"=oitem",optiondata:"=optiondata"},link:function(t,e,i){"function"==typeof t.oitem.isDisabled?t.isDisabled=t.oitem.isDisabled(t.optiondata,t.oitem):t.isDisabled=void 0==t.oitem.isDisabled?!1:t.oitem.isDisabled,"function"==typeof t.oitem.isHide?t.isShow=!t.oitem.isHide(t.optiondata,t.oitem):t.isShow=void 0==t.oitem.isHide?!0:!t.oitem.isHide,t.oitem.isBtn&&!t.isDisabled&&e.bind("click",function(e){var i=t.oitem.callback||function(){};i(t.optiondata,t.oitem)}),t.oitem.isSelect&&!t.isDisabled&&e.bind("change",function(e){var i=t.oitem.callback||function(){};i(t.optiondata,t.optiondata[t.oitem.attrName],t.oitem)})}}}]),UtilsTableFilters.filter("filterAttributes",[function(){return function(t,e,i){if(e&&e.length)for(var n={},o=0;o<e.length;o++)n[e[o].key]=t[e[o].key];else var n=t;return n}}]),UtilsTableFilters.filter("autoSortBy",["$filter","$parse",function(t,e){return function(t,i,n){function o(t,e){for(var n=0;n<i.length;n++){var o=i[n](t,e);if(0!==o)return o}return 0}function r(t,e){return a(e)?function(e,i){return t(i,e)}:t}function a(t){if("function"==typeof t)t=!0;else if(t&&0!==t.length){var e=angular.lowercase(""+t);t=!("f"==e||"0"==e||"false"==e||"no"==e||"n"==e||"[]"==e)}else t=!1;return t}function s(t,e,i){var n=[];return angular.forEach(t,function(t,o,r){n.push(e.call(i,t,o,r))}),n}function l(t,e){var i=typeof t,n=typeof e;if(null==t)return-1;if(null==e)return 1;if(i==n){if("string"==i){if(0==t.length)return-1;if(0==e.length)return 1;t=t.toLowerCase(),e=e.toLowerCase()}return isNaN(Number(t))||isNaN(Number(t))||(t=Number(t),e=Number(e)),t===e?0:e>t?-1:1}return n>i?-1:1}if(!(t instanceof Array))return t;if(!i)return t;i=i instanceof Array?i:[i],i=s(i,function(t){var i=!1,n=t||identity;if(angular.isString(t)&&("+"!=t.charAt(0)&&"-"!=t.charAt(0)||(i="-"==t.charAt(0),t=t.substring(1)),n=e(t),n.constant)){var o=n();return r(function(t,e){return l(t[o],e[o])},i)}return r(function(t,e){return l(n(t),n(e))},i)});for(var c=[],d=0;d<t.length;d++)c.push(t[d]);var u=c.sort(r(o,n));return u}}]);