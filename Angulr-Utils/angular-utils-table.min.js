angular.module("Utils-table",["Utils-table-Directives"]),UtilsTableDirectives=angular.module("Utils-table-Directives",["Utils-table-Filters"]),UtilsTableFilters=angular.module("Utils-table-Filters",[]),UtilsTableDirectives.directive("utilTable",[function(){return{restrict:"ECA",transclude:!0,template:'<table class="table table-bordered"><tr><th ng-repeat="titleItem in config.attr" ng-show="config.attr&&config.attr.length" <span ng-click="setOrderInfo(titleItem)" style="cursor:pointer">{{titleItem.title}}<i class="glyphicon" ng-show="titleItem.key==sortPredicate" ng-class="{true:b, false:a}[reverseOrder]"></i></span></th><th ng-show="config.opt&&config.opt.length">操作</th></tr><tr ng-repeat="rowData in dataSource|limitTo:config.limitLength|filter:config.searchKeyword|autoSortBy:sortPredicate:reverseOrder"><td ng-repeat="attrInfo in rowData|filterAttributes:config.attr">{{attrInfo}}</td><td ng-show="config.opt&&config.opt.length"><span ng-repeat="oItem in config.opt" util-table-btn-options oitem="oItem" optiondata="rowData"></span></td></tr></table>',replace:!0,scope:{config:"=config",dataSource:"=datasource"},link:function(t,e,r){t.sortPredicate=t.config.order.colum||"name",t.reverseOrder=t.config.order.type||!1,t.a="glyphicon-sort-by-attributes",t.b="glyphicon-sort-by-attributes-alt",t.setOrderInfo=function(e){t.sortPredicate=e.key,t.reverseOrder=!t.reverseOrder}}}}]),UtilsTableDirectives.directive("utilTableBtnOptions",[function(){return{restrict:"ECA",transclude:!0,template:'<span><button class="{{oitem.class}}"ng-style="oitem.style" ng-show="oitem.isBtn">{{oitem.title}}</button><select ng-show="oitem.isSelect" ng-model="selectModel" class="{{oitem.class}}"ng-style="oitem.style" ng-options="k.value as k.name for k in oitem.selectOptions"><option value="">无</option></select></span>',replace:!0,scope:{oitem:"=oitem",optiondata:"=optiondata"},link:function(t,e,r){t.oitem.isBtn&&e.bind("click",function(e){var r=t.oitem.callback||function(){};r(t.optiondata,t.oitem)}),t.oitem.isSelect&&e.bind("change",function(e){var r=t.oitem.callback||function(){};r(t.optiondata,t.selectModel,t.oitem)})}}}]),UtilsTableFilters.filter("filterAttributes",[function(){return function(t,e,r){if(e&&e.length)for(var n={},i=0;i<e.length;i++)n[e[i].key]=t[e[i].key];else var n=t;return n}}]),UtilsTableFilters.filter("autoSortBy",["$filter","$parse",function(t,e){return function(t,r,n){function i(t,e){for(var n=0;n<r.length;n++){var i=r[n](t,e);if(0!==i)return i}return 0}function o(t,e){return a(e)?function(e,r){return t(r,e)}:t}function a(t){if("function"==typeof t)t=!0;else if(t&&0!==t.length){var e=angular.lowercase(""+t);t=!("f"==e||"0"==e||"false"==e||"no"==e||"n"==e||"[]"==e)}else t=!1;return t}function l(t,e,r){var n=[];return angular.forEach(t,function(t,i,o){n.push(e.call(r,t,i,o))}),n}function s(t,e){var r=typeof t,n=typeof e;if(null==t)return-1;if(null==e)return 1;if(r==n){if("string"==r){if(0==t.length)return-1;if(0==e.length)return 1;t=t.toLowerCase(),e=e.toLowerCase()}return isNaN(Number(t))||isNaN(Number(t))||(t=Number(t),e=Number(e)),t===e?0:e>t?-1:1}return n>r?-1:1}if(!(t instanceof Array))return t;if(!r)return t;r=r instanceof Array?r:[r],r=l(r,function(t){var r=!1,n=t||identity;if(angular.isString(t)&&("+"!=t.charAt(0)&&"-"!=t.charAt(0)||(r="-"==t.charAt(0),t=t.substring(1)),n=e(t),n.constant)){var i=n();return o(function(t,e){return s(t[i],e[i])},r)}return o(function(t,e){return s(n(t),n(e))},r)});for(var c=[],u=0;u<t.length;u++)c.push(t[u]);var f=c.sort(o(i,n));return f}}]);